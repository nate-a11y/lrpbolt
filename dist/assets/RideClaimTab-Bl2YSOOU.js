import{g as se,a as ae,r as n,u as re,_ as oe,b as q,j as e,s as ne,c as le,d as ie,P as B,e as ce,f as de,T as y,B as b,h as L,D as ue,S as F,i as me,A as xe,k as Y,l as Q,m as J,n as Z,o as X,p as K,q as k,t as fe,v as ee,w as te,x as pe,y as he,F as V,I as $,z as N,M as W,C as ge,E as be}from"./main-Cw184DFO.js";import{G as P}from"./Grid-BrNSD2ap.js";function ye(c){return se("MuiCard",c)}ae("MuiCard",["root"]);const je=["className","raised"],ve=c=>{const{classes:o}=c;return ie({root:["root"]},ye,o)},Ce=ne(B,{name:"MuiCard",slot:"Root",overridesResolver:(c,o)=>o.root})(()=>({overflow:"hidden"})),Se=n.forwardRef(function(o,l){const d=re({props:o,name:"MuiCard"}),{className:u,raised:m=!1}=d,h=oe(d,je),f=q({},d,{raised:m}),p=ve(f);return e.jsx(Ce,q({className:le(p.root,u),elevation:m?8:void 0,ref:l,ownerState:f},h))}),H=({icon:c,label:o,preserveLine:l=!1,highlightColor:d})=>{const[u,...m]=o.split(":");return e.jsxs(b,{display:"flex",alignItems:"flex-start",mb:.5,children:[e.jsx(b,{sx:{minWidth:"30px",pt:"2px"},children:c}),e.jsxs(y,{sx:{whiteSpace:l?"pre-line":"normal",color:d||"inherit"},children:[e.jsxs("strong",{children:[u,":"]}),m.length>0?m.join(":"):""]})]})};function Re({groupKey:c,rides:o,onClaim:l,showToast:d}){const[u,m]=n.useState([]),[h,f]=n.useState({open:!1,message:"",severity:"success"}),[p,,x]=c.split("___"),i=ce(),_=de(i.breakpoints.down("sm")),M=n.useRef(null),[D,w]=n.useState(!1),[R,j]=n.useState([]),v=n.useMemo(()=>window.dayjs(x).format("dddd"),[x]),z=n.useMemo(()=>p.startsWith("LRPSQD")?"🚒":p.startsWith("LRPSPR")?"🚐":p.startsWith("LRPSHU")||p.startsWith("LRPBus")?"🚌":"🚗",[p]),E=t=>{m(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},C=()=>{const t=o.map(s=>s.TripID);m(s=>s.length===t.length?[]:t)},a=async()=>{w(!0),j(u);try{const s=(await Promise.allSettled(u.map(r=>l(r)))).filter(r=>r.status!=="fulfilled");s.length>0?d(`⚠️ ${s.length} of ${u.length} rides failed to claim.`,"warning"):d(`✅ Successfully claimed all ${u.length} rides!`,"success"),m([])}catch{d("❌ One or more rides failed to claim.","error")}finally{w(!1),j([])}},g=async t=>{var s;j(r=>[...r,t]);try{await l(t),m(r=>r.filter(S=>S!==t)),d(`✅ Ride ${t} claimed!`,"success"),(s=M.current)==null||s.scrollIntoView({behavior:"smooth",block:"start"})}catch{d("❌ Failed to claim ride.","error")}finally{j(r=>r.filter(S=>S!==t))}};return o.length?e.jsxs(B,{variant:"outlined",ref:M,sx:{p:2,mb:4,borderLeft:"6px solid #4cbb17",backgroundColor:i.palette.mode==="dark"?"#1e1e1e":"#fefefe"},children:[e.jsxs(b,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,flexWrap:"wrap",gap:1,children:[e.jsxs(y,{variant:"h6",fontWeight:"bold",children:[z," ",p," – 📅 ",v," (",x,")"]}),e.jsxs(y,{variant:"body2",color:"text.secondary",children:["Total: ",o.length," rides"]}),e.jsx(L,{variant:"outlined",size:"small",color:"primary",onClick:C,"aria-label":"Select all rides in group",disabled:D,children:u.length===o.length?"Deselect All":"Select All"})]}),e.jsx(ue,{sx:{mb:2,borderColor:i.palette.mode==="dark"?"#4cbb17":"#81c784",opacity:.75,borderBottomWidth:"2px"}}),e.jsx(F,{spacing:2,children:o.map(t=>{const s=u.includes(t.TripID),r=R.includes(t.TripID),S=me(t.PickupTime,t.RideDuration);return e.jsx(Se,{variant:"outlined",sx:{p:2,backgroundColor:s?i.palette.mode==="dark"?"#324d28":"#e8f5e9":i.palette.mode==="dark"?"#2a2a2a":"#ffffff",border:s?"2px solid #4cbb17":"1px solid",borderColor:s?"#4cbb17":i.palette.divider,transition:"background 0.3s ease","&:hover":{background:i.palette.mode==="dark"?"linear-gradient(145deg, #355d2e, #2e4727)":"linear-gradient(145deg, #e2fbe8, #d0f0d6)"}},children:e.jsxs(P,{container:!0,spacing:2,children:[e.jsxs(P,{item:!0,xs:12,children:[e.jsx(H,{icon:"🆔",label:`ID: ${t.TripID}`}),e.jsxs(b,{display:"flex",alignItems:"baseline",gap:1,mb:1,children:[e.jsx(xe,{fontSize:"small",sx:{mt:"2px",color:i.palette.text.secondary}}),e.jsxs(y,{variant:"body2",color:"text.primary",children:["Time: ",t.PickupTime," → ",S]}),e.jsx(b,{sx:{display:"inline-flex",alignItems:"baseline",px:1.25,py:.25,borderRadius:"20px",backgroundColor:i.palette.mode==="dark"?"#19391d":"#e6f4ea",color:i.palette.mode==="dark"?"#60e421":"#2e7d32",fontWeight:700,fontSize:"0.75rem",border:"1px solid",borderColor:i.palette.mode==="dark"?"#4cbb17":"#a5d6a7",boxShadow:i.palette.mode==="dark"?"0 0 4px rgba(76, 187, 23, 0.4)":"inset 0 0 0 1px #c8e6c9",textTransform:"uppercase",letterSpacing:"0.5px"},children:t.RideDuration})]}),e.jsx(H,{icon:"🔁",label:`Type: ${t.RideType}`,highlightColor:t.RideType==="Hourly"?"#4cbb17":void 0}),t.RideNotes&&e.jsx(H,{icon:"📝",label:`Notes: ${t.RideNotes}`,preserveLine:!0})]}),e.jsx(P,{item:!0,xs:12,children:e.jsxs(F,{direction:"row",spacing:1,alignItems:"center",justifyContent:_?"flex-start":"flex-end",flexWrap:"wrap",children:[e.jsx(b,{onClick:()=>E(t.TripID),sx:{cursor:"pointer",px:1,py:.25,borderRadius:"20px",fontSize:"0.75rem",fontWeight:600,border:"1px solid",borderColor:s?"#4cbb17":i.palette.divider,backgroundColor:s?"#4cbb17":i.palette.mode==="dark"?"#2a2a2a":"#f0f0f0",color:s?"#fff":i.palette.text.primary,textAlign:"center",transition:"all 0.2s ease","&:hover":{backgroundColor:s?"#60e421":"#ddd"}},children:s?"✅ Selected":"Select"}),e.jsx(L,{variant:"contained",color:"success",size:"small",sx:{fontWeight:"bold",borderRadius:2,boxShadow:i.palette.mode==="dark"?"0 0 3px #60e421":"0 0 2px #a5d6a7","&:hover":{boxShadow:i.palette.mode==="dark"?"0 0 5px rgba(96, 228, 33, 0.8)":"0 0 4px rgba(76, 187, 23, 0.4)"}},onClick:()=>g(t.TripID),disabled:D||r,children:r?"⏳ Claiming...":"✅ Claim"})]})})]})},t.TripID)})}),u.length>0&&e.jsx(b,{textAlign:"center",mt:3,children:e.jsxs(L,{variant:"contained",color:"primary",onClick:a,disabled:D,children:["🛒 CLAIM ",u.length," SELECTED RIDES"]})}),e.jsx(Y,{open:h.open,autoHideDuration:4e3,onClose:()=>f({...h,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Q,{severity:h.severity,variant:"filled",onClose:()=>f({...h,open:!1}),children:h.message})})]}):e.jsx(B,{variant:"outlined",sx:{p:3,mb:3,textAlign:"center"},children:e.jsx(y,{variant:"subtitle1",color:"text.secondary",children:"📭 No rides available in this group."})})}var I={},O;function ke(){if(O)return I;O=1;var c=J();Object.defineProperty(I,"__esModule",{value:!0}),I.default=void 0;var o=c(Z()),l=X();return I.default=(0,o.default)((0,l.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),I}var De=ke();const we=K(De);var T={},G;function Ie(){if(G)return T;G=1;var c=J();Object.defineProperty(T,"__esModule",{value:!0}),T.default=void 0;var o=c(Z()),l=X();return T.default=(0,o.default)((0,l.jsx)("path",{d:"m18 22-.01-6L14 12l3.99-4.01L18 2H6v6l4 4-4 3.99V22zM8 7.5V4h8v3.5l-4 4z"}),"HourglassBottom"),T}var Te=Ie();const Le=K(Te);k.extend(ee);k.extend(te);const U=fe,_e=({isAdmin:c,isLocked:o,onUnlock:l})=>{const[d,u]=n.useState(0);if(n.useEffect(()=>{const f=()=>{const x=k().tz(U),_=(x.hour()>=20?x.add(1,"day").hour(20).minute(0).second(0):x.hour()>=18?x.hour(20).minute(0).second(0):x).diff(x,"second");u(_)};f();const p=setInterval(f,1e3);return()=>clearInterval(p)},[]),n.useEffect(()=>{d===0&&typeof l=="function"&&l()},[d,l]),!o||c)return null;const m=Math.floor(d/60),h=d%60;return e.jsxs(b,{position:"absolute",minHeight:"300px",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(0,0,0,0.95)",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",sx:{borderRadius:2},children:[e.jsx(we,{sx:{fontSize:60,color:"warning.main",mb:2,filter:"drop-shadow(0 0 6px lime)"}}),e.jsx(y,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Ride Claim Locked"}),e.jsxs(y,{variant:"body1",sx:{mb:2},children:["Come back at ",e.jsx("strong",{children:"8:00 PM"})," local time to start claiming rides again."]}),e.jsxs(L,{variant:"outlined",color:"success",startIcon:e.jsx(Le,{}),sx:{fontSize:"1.1rem",px:3,py:1,borderRadius:2},children:[m,"m ",h.toString().padStart(2,"0"),"s"]}),e.jsxs(y,{variant:"caption",mt:2,sx:{color:"gray"},children:["🕓 Debug Time: ",k().tz(U).format("YYYY-MM-DD hh:mm:ss A")]})]})};k.extend(ee);k.extend(te);const We=({driver:c,isAdmin:o=!0,isLockedOut:l=!1})=>{const[d,u]=n.useState([]),[m,h]=n.useState({}),[f,p]=n.useState(""),[x,i]=n.useState(""),[_,M]=n.useState([]),[D,w]=n.useState(!1),[R,j]=n.useState({open:!1,message:"",severity:"success"}),v=n.useRef(!1),z=(a,g="success")=>j({open:!0,message:a,severity:g}),E=async a=>{const g=await be(a,c);if(g.success)return M(t=>[...t,{tripId:a,time:new Date().toLocaleTimeString()}]),v.current=!1,C(),!0;throw new Error(g.message||"Claim failed")},C=n.useCallback(async()=>{w(!0);try{const g=(await pe()).filter(s=>{const r=(s.ClaimedBy||"").toString().trim().toLowerCase();return r===""||r==="unclaimed"||r==="null"||r==="none"});u(g);const t={};g.forEach(s=>{const r=he(s.Date),S=new Date(r).toLocaleDateString("en-US",{weekday:"long"}),A=`${s.Vehicle}___${S}___${r}`;t[A]||(t[A]=[]),t[A].push(s)}),h(t)}catch{z("❌ Failed to load rides. Try again later.","error")}finally{w(!1)}},[]);return n.useEffect(()=>{c&&!l&&!v.current&&(v.current=!0,C())},[c,l,C]),e.jsxs(b,{position:"relative",children:[l&&e.jsx(_e,{isAdmin:o,isLocked:l,onUnlock:()=>{v.current=!1,C()}}),e.jsxs(b,{display:"flex",gap:2,mb:3,flexWrap:"wrap",children:[e.jsxs(V,{sx:{minWidth:160},children:[e.jsx($,{children:"Day"}),e.jsxs(N,{value:x,onChange:a=>i(a.target.value),label:"Day",children:[e.jsx(W,{value:"",children:"All"}),["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map(a=>e.jsx(W,{value:a,children:a},a))]})]}),e.jsxs(V,{sx:{minWidth:160},children:[e.jsx($,{children:"Vehicle"}),e.jsxs(N,{value:f,onChange:a=>p(a.target.value),label:"Vehicle",children:[e.jsx(W,{value:"",children:"All"}),Array.from(new Set(d.map(a=>a.Vehicle))).map(a=>e.jsx(W,{value:a,children:a},a))]})]}),e.jsx(L,{variant:"outlined",onClick:()=>{v.current=!1,C()},children:"🔄 Refresh"})]}),D?e.jsxs(b,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200,children:[e.jsx(y,{variant:"body1",color:"text.secondary",mr:2,children:"Loading rides..."}),e.jsx(ge,{size:28})]}):e.jsxs(e.Fragment,{children:[Object.entries(m).map(([a,g])=>{const[t,s]=a.split("___");return f&&t!==f||x&&s!==x?null:e.jsx(Re,{groupKey:a,rides:g,onClaim:E,showToast:z},a)}),Object.keys(m).length===0&&e.jsx(y,{variant:"body1",color:"text.secondary",textAlign:"center",mt:5,children:"🚫 No unclaimed rides available right now."})]}),e.jsx(Y,{open:R.open,autoHideDuration:3e3,onClose:()=>j({...R,open:!1}),children:e.jsx(Q,{severity:R.severity,variant:"filled",children:R.message})})]})};export{We as default};
