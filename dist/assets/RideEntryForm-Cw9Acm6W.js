import{a6 as Re,a7 as Se,_ as ve,j as e,b as re,r as t,M as H,a8 as ls,a9 as os,c as cs,d as ds,aa as us,ab as ke,ac as hs,ad as ms,ae as Me,af as fs,m as Ve,n as He,o as Ue,p as $e,f as Ge,ag as ps,ah as _e,B as M,N as ae,ai as xs,aj as be,U as qe,ak as _,al as q,am as he,an as F,O as V,F as Pe,z as we,ao as Le,ap as Q,h as T,T as b,k as le,l as oe,C as pe,a2 as je,aq as me,t as ne,ar as gs,a1 as xe,x as Fe,as as Qe,y as Ze,at as ge,au as Je,av as fe,aw as js,q as z,ax as ys,ay as De,P as Be,$ as Ne,a0 as ee,az as Ce,v as Ds,w as Cs}from"./main-Cw184DFO.js";import{G as k}from"./Grid-BrNSD2ap.js";const vs=["label","icon","showInMenu","onClick"],bs=["label","icon","showInMenu","onClick","closeMenuOnClick","closeMenu"],Oe=Re((r,p)=>{var C;const l=Se();if(!r.showInMenu){const{label:j,icon:s,onClick:a}=r,g=ve(r,vs),c=y=>{a==null||a(y)};return e.jsx(l.slots.baseIconButton,re({size:"small",role:"menuitem","aria-label":j},g,{onClick:c},(C=l.slotProps)==null?void 0:C.baseIconButton,{ref:p,children:t.cloneElement(s,{fontSize:"small"})}))}const{label:u,icon:m,onClick:d,closeMenuOnClick:R=!0,closeMenu:S}=r,o=ve(r,bs),x=j=>{d==null||d(j),R&&(S==null||S())};return e.jsxs(H,re({ref:p},o,{onClick:x,children:[m&&e.jsx(ls,{children:m}),u]}))}),Ts=["className","children"],Rs=r=>{const{classes:p}=r;return ds({root:["toolbarContainer"]},us,p)},Ss=os("div",{name:"MuiDataGrid",slot:"ToolbarContainer",overridesResolver:(r,p)=>p.toolbarContainer})(({theme:r})=>({display:"flex",alignItems:"center",flexWrap:"wrap",gap:r.spacing(1),padding:r.spacing(.5,.5,0)})),Is=Re(function(p,l){const{className:u,children:m}=p,d=ve(p,Ts),R=Se(),S=Rs(R);return m?e.jsx(Ss,re({className:cs(S.root,u),ownerState:R},d,{ref:l,children:m})):null}),ks=Re(function(p,l){var a,g;const{slotProps:u={}}=p,m=u.button||{},d=u.tooltip||{},R=ke(),S=ke(),o=hs(),x=Se(),C=ms(o,fs),j=c=>{var y;C.open&&C.openedPanelValue===Me.columns?o.current.hidePreferences():o.current.showPreferences(Me.columns,S,R),(y=m.onClick)==null||y.call(m,c)};if(x.disableColumnSelector)return null;const s=C.open&&C.panelId===S;return e.jsx(x.slots.baseTooltip,re({title:o.current.getLocaleText("toolbarColumnsLabel"),enterDelay:1e3},(a=x.slotProps)==null?void 0:a.baseTooltip,d,{children:e.jsx(x.slots.baseButton,re({id:R,size:"small","aria-label":o.current.getLocaleText("toolbarColumnsLabel"),"aria-haspopup":"menu","aria-expanded":s,"aria-controls":s?S:void 0,startIcon:e.jsx(x.slots.columnSelectorIcon,{})},(g=x.slotProps)==null?void 0:g.baseButton,m,{onPointerUp:c=>{var y;C.open&&c.stopPropagation(),(y=m.onPointerUp)==null||y.call(m,c)},onClick:j,ref:l,children:o.current.getLocaleText("toolbarColumns")}))}))});var se={},Ee;function Ms(){if(Ee)return se;Ee=1;var r=Ve();Object.defineProperty(se,"__esModule",{value:!0}),se.default=void 0;var p=r(He()),l=Ue();return se.default=(0,p.default)((0,l.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),se}var Ps=Ms();const We=$e(Ps);var te={},Ae;function ws(){if(Ae)return te;Ae=1;var r=Ve();Object.defineProperty(te,"__esModule",{value:!0}),te.default=void 0;var p=r(He()),l=Ue();return te.default=(0,p.default)((0,l.jsx)("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"InfoOutlined"),te}var Ls=ws();const Bs=$e(Ls),Ns=["LRPBus - Limo Bus","LRPSHU - Shuttle","LRPSPR - Sprinter","LRPSQD - Rescue Squad"],Os=["P2P","Round-Trip","Hourly"],Xe=({rows:r,onDelete:p,loading:l=!1,refreshRides:u,sheetName:m="RideQueue"})=>{var ce;const d=Ge("(max-width:600px)"),[R,S]=t.useState({}),[o,x]=t.useState(null),[C,j]=t.useState(!1),[s,a]=t.useState(null),[g,c]=t.useState({open:!1,message:"",severity:"success"}),[y,P]=t.useState(!1),[U,A]=t.useState(!1),Z="https://lakeridepros.xyz/Color%20logo%20-%20no%20background.png",Y=t.useCallback(n=>{const w=ps((n==null?void 0:n.RideDuration)||""),$=window.dayjs(`2000-01-01 ${n==null?void 0:n.PickupTime}`,"YYYY-MM-DD h:mm A"),G=$.isValid()?$.format("HH:mm"):"",X=window.dayjs(n==null?void 0:n.Date,["MM/DD/YYYY","YYYY-MM-DD"]),W=X.isValid()?X.format("YYYY-MM-DD"):"";a({...n,PickupTime:G,Date:W,DurationHours:w.hours,DurationMinutes:w.minutes}),j(!0)},[a,j]),J=((ce=_e.currentUser)==null?void 0:ce.email)||"Unknown",L=t.useMemo(()=>{if(!s)return{};const n={};return["TripID","Date","PickupTime","RideType","Vehicle"].forEach(w=>{(!s[w]||s[w].toString().trim()==="")&&(n[w]="Required")}),n},[s]),D=Object.keys(L).length===0,I=async()=>{if(!D)return;P(!0);const n=me(s.DurationHours,s.DurationMinutes),w=window.dayjs(`2000-01-01 ${s.PickupTime}`,"YYYY-MM-DD HH:mm").tz(ne).format("h:mm A"),G={Date:window.dayjs(s.Date).format("MM/DD/YYYY"),PickupTime:w,RideDuration:n,RideType:s.RideType,Vehicle:s.Vehicle,RideNotes:s.RideNotes,LastModifiedBy:J};if(!Object.entries(G).some(([W,ye])=>{var K;const de=W==="RideDuration"?o[W]:(K=o[W])==null?void 0:K.toString().trim();return ye!==de})){c({open:!0,message:"⚠️ No changes to save.",severity:"info"}),P(!1);return}try{const W=await gs(s.TripID,G,m);if(!W.success)throw new Error(W.message||"Update failed");c({open:!0,message:"✅ Ride updated successfully.",severity:"success"}),x(null),j(!1),u&&u()}catch(W){c({open:!0,message:`❌ ${W.message}`,severity:"error"})}finally{P(!1)}},O=t.useMemo(()=>[{field:"TripID",headerName:"Trip ID",minWidth:120,flex:1,renderCell:n=>e.jsxs(M,{display:"flex",alignItems:"center",gap:1,children:[n.value,e.jsx(ae,{title:"Click row to view ride details",children:e.jsx(Bs,{fontSize:"small",color:"action"})})]})},{field:"Date",headerName:"Date",minWidth:110,flex:1},{field:"PickupTime",headerName:"Pickup Time",minWidth:100,flex:1},{field:"RideDuration",headerName:"Duration",minWidth:100,flex:1},{field:"RideType",headerName:"Ride Type",minWidth:120,flex:1},{field:"Vehicle",headerName:"Vehicle",minWidth:150,flex:1.5},{field:"RideNotes",headerName:"Notes",minWidth:180,flex:2},{field:"CreatedBy",headerName:"Created By",minWidth:140,flex:1},{field:"LastModifiedBy",headerName:"Modified By",minWidth:140,flex:1},{field:"actions",type:"actions",width:80,getActions:n=>[e.jsx(Oe,{icon:e.jsx(xs,{}),label:"Edit",onClick:()=>{x(n.row),Y(n.row)}},"edit"),e.jsx(Oe,{icon:e.jsx(be,{}),label:"Delete",onClick:()=>p(n.row.TripID)},"delete")]}],[x,Y,p]),B=()=>e.jsxs(Is,{sx:{justifyContent:"space-between",px:1},children:[e.jsx(ks,{}),e.jsx(ae,{title:"Reload ride data from Google Sheets",children:e.jsx("span",{children:e.jsx(T,{onClick:u,disabled:l,variant:"outlined",size:"small",startIcon:l?e.jsx(pe,{size:16,sx:{color:"inherit"}}):e.jsx(je,{}),children:l?"Refreshing...":"Refresh"})})})]});return e.jsxs(e.Fragment,{children:[d&&e.jsx(M,{textAlign:"center",py:1,bgcolor:"#fff3cd",color:"#856404",children:"👉 Swipe horizontally to view more columns"}),e.jsx(M,{sx:{width:"100%",overflowX:"auto"},children:e.jsx(qe,{getRowId:n=>n.TripID,rows:r,columns:O,autoHeight:!0,pageSize:5,loading:l,disableRowSelectionOnClick:!0,onRowClick:n=>{j(!1),x(n.row),A(!0)},columnVisibilityModel:R,onColumnVisibilityModelChange:S,components:{Toolbar:B}})}),e.jsxs(_,{open:C,onClose:()=>{j(!1),a(null)},maxWidth:"sm",fullWidth:!0,children:[e.jsxs(q,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Ride Details",e.jsx(he.img,{src:Z,alt:"Lake Ride Pros Logo",initial:{scale:.5,opacity:0,rotate:-15},animate:{scale:1,opacity:1,rotate:0},transition:{type:"spring",stiffness:200,damping:12,delay:.2},style:{height:32,marginLeft:"8px",filter:"drop-shadow(0 0 2px rgba(0,0,0,0.4))"}})]}),e.jsx(F,{dividers:!0,children:e.jsxs(k,{container:!0,spacing:2,children:[e.jsx(k,{item:!0,xs:6,children:e.jsx(V,{label:"Date",type:"date",fullWidth:!0,name:"Date",value:(s==null?void 0:s.Date)||"",onChange:n=>a({...s,Date:n.target.value}),InputLabelProps:{shrink:!0},error:!!L.Date,helperText:L.Date})}),e.jsx(k,{item:!0,xs:6,children:e.jsx(V,{label:"Pickup Time",type:"time",fullWidth:!0,name:"PickupTime",value:(s==null?void 0:s.PickupTime)||"",onChange:n=>a({...s,PickupTime:n.target.value}),InputLabelProps:{shrink:!0},error:!!L.PickupTime,helperText:L.PickupTime})}),e.jsx(k,{item:!0,xs:6,children:e.jsx(V,{label:"Hours",type:"number",fullWidth:!0,value:(s==null?void 0:s.DurationHours)||"",onChange:n=>a({...s,DurationHours:n.target.value})})}),e.jsx(k,{item:!0,xs:6,children:e.jsx(V,{label:"Minutes",type:"number",fullWidth:!0,value:(s==null?void 0:s.DurationMinutes)||"",onChange:n=>a({...s,DurationMinutes:n.target.value})})}),e.jsx(k,{item:!0,xs:12,children:e.jsxs(Pe,{fullWidth:!0,error:!!L.RideType,children:[e.jsxs(we,{value:(s==null?void 0:s.RideType)||"",onChange:n=>a({...s,RideType:n.target.value}),displayEmpty:!0,children:[e.jsx(H,{value:"",disabled:!0,children:"Select Ride Type"}),Os.map(n=>e.jsx(H,{value:n,children:n},n))]}),e.jsx(Le,{children:L.RideType})]})}),e.jsx(k,{item:!0,xs:12,children:e.jsxs(Pe,{fullWidth:!0,error:!!L.Vehicle,children:[e.jsxs(we,{value:(s==null?void 0:s.Vehicle)||"",onChange:n=>a({...s,Vehicle:n.target.value}),displayEmpty:!0,children:[e.jsx(H,{value:"",disabled:!0,children:"Select Vehicle"}),Ns.map(n=>e.jsx(H,{value:n,children:n},n))]}),e.jsx(Le,{children:L.Vehicle})]})}),e.jsx(k,{item:!0,xs:12,children:e.jsx(V,{label:"Ride Notes",fullWidth:!0,multiline:!0,rows:2,value:(s==null?void 0:s.RideNotes)||"",onChange:n=>a({...s,RideNotes:n.target.value})})})]})}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>{j(!1),a(null)},children:"Cancel"}),e.jsx(T,{onClick:I,variant:"contained",color:"primary",disabled:!D||y,children:y?"Saving...":"Save"})]})]}),e.jsxs(_,{open:U,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(q,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Ride Details",e.jsx(he.img,{src:Z,alt:"Lake Ride Pros Logo",initial:{scale:.5,opacity:0,rotate:-15},animate:{scale:1,opacity:1,rotate:0},transition:{type:"spring",stiffness:200,damping:12,delay:.2},style:{height:32,marginLeft:"8px",filter:"drop-shadow(0 0 2px rgba(0,0,0,0.4))"}})]}),e.jsx(F,{dividers:!0,children:o?e.jsxs(M,{children:[e.jsxs(b,{children:[e.jsx("strong",{children:"Trip ID:"})," ",e.jsx("span",{style:{color:"limegreen",fontWeight:600},children:o.TripID})]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Date:"})," ",o.Date]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Pickup Time:"})," ",o.PickupTime]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Duration:"})," ",o.RideDuration]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Ride Type:"})," ",o.RideType]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Vehicle:"})," ",o.Vehicle]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Notes:"})," ",o.RideNotes]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Created By:"})," ",o.CreatedBy]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Last Modified By:"})," ",o.LastModifiedBy]})]}):e.jsx(b,{children:"No ride selected"})}),e.jsxs(Q,{children:[e.jsx(he.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(T,{onClick:()=>A(!1),children:"Close"})}),e.jsx(he.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(T,{onClick:()=>{Y(o),A(!1)},variant:"contained",color:"primary",children:"Edit"})})]})]}),e.jsx(le,{open:g.open,autoHideDuration:4e3,onClose:(n,w)=>{w!=="clickaway"&&c({...g,open:!1})},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(oe,{severity:g.severity,sx:{width:"100%"},children:g.message})})]})},Es=({refreshTrigger:r})=>{const[p,l]=t.useState([]),[u,m]=t.useState({open:!1,message:"",severity:"success"}),[d,R]=t.useState(!0),[S,o]=t.useState(!1),[x,C]=t.useState(""),[j,s]=t.useState(!1),a=()=>{R(!0),Fe().then(c=>{const y=c.map((P,U)=>({id:P.TripID,...P,Date:Ze(P.Date),PickupTime:Qe(P.PickupTime)}));l(y)}).catch(c=>{m({open:!0,message:`❌ Failed to load rides: ${c.message}`,severity:"error"})}).finally(()=>R(!1))};t.useEffect(()=>{a()},[r]);const g=async()=>{s(!0);const c=await ge(x,"Sheet1");c.success?(l(y=>y.filter(P=>P.TripID!==x)),m({open:!0,message:`🗑️ Deleted Trip ${x}`,severity:"info"})):m({open:!0,message:`❌ ${c.message}`,severity:"error"}),s(!1),o(!1)};return e.jsxs(M,{children:[e.jsx(M,{display:"flex",justifyContent:"flex-end",alignItems:"center",mb:1,children:e.jsx(ae,{title:"Refresh Ride List",children:e.jsx("span",{children:e.jsx(xe,{onClick:a,disabled:d,"aria-label":"Refresh rides",children:e.jsx(je,{sx:{animation:d?"spin 1s linear infinite":"none"}})})})})}),e.jsx(Xe,{rows:p,loading:d,onDelete:c=>{C(c),o(!0)},refreshRides:a,sheetName:"Sheet1"}),e.jsxs(_,{open:S,onClose:()=>o(!1),children:[e.jsx(q,{children:"Delete Ride?"}),e.jsx(F,{children:e.jsxs(b,{children:["Are you sure you want to delete ",e.jsx("strong",{children:x}),"?"]})}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>o(!1),children:"Cancel"}),e.jsx(T,{onClick:g,variant:"contained",color:"error",disabled:j,children:j?"Deleting...":"Delete"})]})]}),e.jsx(le,{open:u.open,autoHideDuration:3e3,onClose:()=>m({...u,open:!1}),children:e.jsx(oe,{onClose:()=>m({...u,open:!1}),severity:u.severity,variant:"filled",children:u.message})}),e.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]})},Ws=({refreshTrigger:r})=>{const[p,l]=t.useState([]),[u,m]=t.useState({open:!1,message:"",severity:"success"}),[d,R]=t.useState(!0),[S,o]=t.useState(!1),[x,C]=t.useState(null),j=()=>{R(!0),Je().then(a=>{const g=a.map((c,y)=>({id:c.TripID,...c,Date:Ze(c.Date),PickupTime:Qe(c.PickupTime)}));l(g)}).catch(a=>{m({open:!0,message:`❌ Failed to load rides: ${a.message}`,severity:"error"})}).finally(()=>R(!1))};t.useEffect(()=>{j()},[r]);const s=async()=>{if(!x)return;const a=await ge(x,"RideQueue");a.success?(l(g=>g.filter(c=>c.TripID!==x)),m({open:!0,message:`🗑️ Deleted Trip ${x}`,severity:"info"})):m({open:!0,message:`❌ ${a.message}`,severity:"error"}),o(!1),C(null)};return e.jsxs(M,{children:[e.jsx(M,{display:"flex",justifyContent:"flex-end",alignItems:"center",mb:1,children:e.jsx(ae,{title:"Refresh Ride Queue",children:e.jsx("span",{children:e.jsx(xe,{onClick:j,disabled:d,"aria-label":"Refresh rides",children:e.jsx(je,{sx:{animation:d?"spin 1s linear infinite":"none"}})})})})}),e.jsx(Xe,{rows:p,loading:d,onDelete:a=>{C(a),o(!0)},refreshRides:j,sheetName:"RideQueue"}),e.jsxs(_,{open:S,onClose:()=>o(!1),children:[e.jsx(q,{children:"Delete Ride?"}),e.jsx(F,{children:e.jsxs(b,{children:["Are you sure you want to delete ",e.jsx("strong",{children:x})," from the Ride Queue?"]})}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>o(!1),children:"Cancel"}),e.jsx(T,{onClick:s,variant:"contained",color:"error",children:"Delete"})]})]}),e.jsx(le,{open:u.open,autoHideDuration:3e3,onClose:()=>m({...u,open:!1}),children:e.jsx(oe,{onClose:()=>m({...u,open:!1}),severity:u.severity,variant:"filled",children:u.message})}),e.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]})},As=`${fe}?type=claimedRides`,Ys=({refreshTrigger:r=0})=>{const[p,l]=t.useState([]),[u,m]=t.useState(null),[d,R]=t.useState([]),[S,o]=t.useState(!1),[x,C]=t.useState(!1),[j,s]=t.useState(!1),[a,g]=t.useState({open:!1,message:"",severity:"info",undoable:!1}),[c,y]=t.useState(!0),[P,U]=t.useState([]),A=async()=>{y(!0);try{const I=await(await fetch(As)).json();if(!Array.isArray(I))throw new Error("Invalid data structure");const O=I.map(B=>({TripID:B.TripID,ClaimedBy:B.ClaimedBy,ClaimedAt:B.ClaimedAt||"N/A",fading:!1}));l(O)}catch(D){console.error("Error loading claimed rides:",D),g({open:!0,message:"❌ Failed to load claimed rides",severity:"error"})}finally{y(!1)}};t.useEffect(()=>{A()},[r]);const Z=async()=>{u!=null&&u.TripID&&(y(!0),U([u]),l(D=>D.map(I=>I.TripID===u.TripID?{...I,fading:!0}:I)),setTimeout(async()=>{const D=await ge(u.TripID,"Sheet1");D.success?(g({open:!0,message:"🗑️ Ride deleted",severity:"info",undoable:!0}),A()):g({open:!0,message:`❌ ${D.message}`,severity:"error"}),y(!1),o(!1)},300))},Y=async()=>{y(!0);const D=p.filter(I=>d.includes(I.TripID));U(D),l(I=>I.map(O=>d.includes(O.TripID)?{...O,fading:!0}:O)),setTimeout(async()=>{try{await Promise.all(d.map(I=>ge(I,"Sheet1"))),g({open:!0,message:"✅ Selected rides deleted",severity:"info",undoable:!0}),R([]),A()}catch(I){g({open:!0,message:`❌ Bulk delete failed: ${I.message}`,severity:"error"})}finally{y(!1),C(!1)}},300)},J=async()=>{if(!P.length)return;y(!0);const D=[];(await Promise.all(P.map(O=>js(O)))).forEach((O,B)=>{O.success||D.push(P[B].TripID)}),D.length?g({open:!0,message:`⚠️ Failed to restore: ${D.join(", ")}`,severity:"warning",undoable:!1}):(g({open:!0,message:"✅ Undo successful",severity:"success",undoable:!1}),A()),U([]),y(!1)},L=[{field:"TripID",headerName:"Trip ID",flex:1},{field:"ClaimedBy",headerName:"Claimed By",flex:1},{field:"ClaimedAt",headerName:"Claimed At",flex:1},{field:"actions",headerName:"",width:80,sortable:!1,renderCell:D=>e.jsx(xe,{color:"error",onClick:()=>{m(D.row),o(!0)},children:e.jsx(be,{})})}];return e.jsxs(M,{children:[d.length>0&&e.jsxs(M,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{bgcolor:"#ff1744",color:"#fff",px:2,py:1,mb:2,borderRadius:1,boxShadow:3},children:[e.jsxs(b,{children:[d.length," selected"]}),e.jsx(T,{onClick:()=>C(!0),variant:"contained",color:"inherit",startIcon:e.jsx(be,{}),sx:{bgcolor:"#fff",color:"#ff1744","&:hover":{bgcolor:"#eee"}},children:"Delete Selected"})]}),e.jsx(M,{display:"flex",justifyContent:"flex-end",mb:1,children:e.jsx(ae,{title:"Refresh Claimed Rides",children:e.jsx("span",{children:e.jsx(xe,{onClick:A,disabled:c,children:e.jsx(je,{sx:{animation:c?"spin 1s linear infinite":"none"}})})})})}),e.jsx(qe,{getRowId:D=>D.TripID,rows:p,columns:L,autoHeight:!0,checkboxSelection:!0,disableRowSelectionOnClick:!0,getRowClassName:D=>D.row.fading?"fade-out":"",onRowSelectionModelChange:D=>{const I=Array.from(D.ids);R(I)},loading:c,sx:{bgcolor:"background.paper"}}),e.jsxs(_,{open:S,onClose:()=>o(!1),children:[e.jsx(q,{children:"Delete Ride?"}),e.jsx(F,{children:e.jsxs(b,{children:["Are you sure you want to delete ",e.jsx("strong",{children:u==null?void 0:u.TripID}),"?"]})}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>o(!1),children:"Cancel"}),e.jsx(T,{onClick:Z,variant:"contained",color:"error",disabled:c,startIcon:c?e.jsx(pe,{size:18,color:"inherit"}):null,children:c?"Deleting...":"Delete"})]})]}),e.jsxs(_,{open:x,onClose:()=>C(!1),children:[e.jsx(q,{children:"Delete Selected Rides"}),e.jsx(F,{children:e.jsxs(b,{children:["Are you sure you want to delete ",e.jsx("strong",{children:d.length})," rides?"]})}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(T,{onClick:Y,variant:"contained",color:"error",disabled:c,startIcon:c?e.jsx(pe,{size:18,color:"inherit"}):null,children:c?"Deleting...":"Delete All"})]})]}),e.jsxs(_,{open:j,onClose:()=>s(!1),children:[e.jsx(q,{children:"Restore Deleted Rides?"}),e.jsx(F,{children:e.jsxs(b,{children:["This will restore ",P.length," ride",P.length===1?"":"s"," back into the system. Are you sure?"]})}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>s(!1),children:"Cancel"}),e.jsx(T,{onClick:()=>{J(),s(!1)},variant:"contained",color:"success",children:"Yes, Undo"})]})]}),e.jsx(le,{open:a.open,autoHideDuration:4e3,onClose:()=>g({...a,open:!1}),children:e.jsx(oe,{severity:a.severity,onClose:()=>g({...a,open:!1}),action:a.undoable&&e.jsx(T,{color:"inherit",size:"small",onClick:()=>s(!0),children:"UNDO"}),children:a.message})}),e.jsx("style",{children:`
          @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; transform: scale(0.98); }
          }
          .fade-out {
            animation: fadeOut 0.4s ease-in-out forwards;
          }
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]})};z.extend(Ds);z.extend(Cs);const ie={TripID:"",Date:"",PickupTime:"",DurationHours:"",DurationMinutes:"",RideType:"",Vehicle:"",RideNotes:""},zs=/^[A-Z0-9]{4}-[A-Z0-9]{2}$/i,Ye=["P2P","Round-Trip","Hourly"],ze=["LRPBus - Limo Bus","LRPSHU - Shuttle","LRPSPR - Sprinter","LRPSQD - Rescue Squad"],Te=[{name:"TripID",label:"Trip ID",sm:6},{name:"Date",label:"Date",type:"date",sm:6,shrink:!0},{name:"PickupTime",label:"Pickup Time",type:"time",sm:6,shrink:!0},{name:"DurationHours",label:"Duration Hours",type:"number",sm:3},{name:"DurationMinutes",label:"Duration Minutes",type:"number",sm:3},{name:"RideType",label:"Ride Type",type:"select",sm:6},{name:"Vehicle",label:"Vehicle",type:"select",sm:6}],Vs=[...Te.map(r=>r.name),"RideDuration","RideNotes"];function $s(){var Ie;const[r,p]=t.useState(ie),[l,u]=t.useState(ie),[m,d]=t.useState({open:!1,message:"",severity:"success"}),R=t.useMemo(()=>{const i=me(r.DurationHours,r.DurationMinutes),v=r.Date?z(r.Date).tz(ne).format("M/D/YYYY"):"N/A",h=ys(r.PickupTime);return{...r,PickupTime:h,Date:v,RideDuration:i}},[r]),[S,o]=t.useState(0),[x,C]=t.useState(!1),[j,s]=t.useState(!1),[a,g]=t.useState(0),[c,y]=t.useState(0),[P,U]=t.useState(0),[A,Z]=t.useState(""),[Y,J]=t.useState(""),[L,D]=t.useState(0),[I,O]=t.useState(!1),[B,ce]=t.useState(0),n=Ge("(max-width:600px)"),w=((Ie=_e.currentUser)==null?void 0:Ie.email)||"Unknown",$=t.useRef({});t.useEffect(()=>{const i=async()=>{try{const h=await Fe();if(!Array.isArray(h))return;const N=h.filter(f=>!f.ClaimedBy&&f.Status!=="Queued"),E=h.filter(f=>{var ue;return f.ClaimedBy&&f.ClaimedBy.trim()!==""||((ue=f.Status)==null?void 0:ue.toLowerCase())==="claimed"});g(N.length),y(E.length)}catch(h){console.error("Error fetching rides:",h)}},v=async()=>{try{const h=await Je();if(!Array.isArray(h))return;U(h.length)}catch(h){console.error("Error fetching queue:",h)}};i(),v(),Z(z().format("hh:mm A"))},[]);const G=i=>{var N;const v=["TripID","Date","PickupTime","RideType","Vehicle"],h={};for(const E of v)(N=i[E])!=null&&N.trim()||(h[E]=!0);return zs.test(i.TripID)||(h.TripID=!0),(isNaN(+i.DurationMinutes)||+i.DurationMinutes<0||+i.DurationMinutes>59)&&(h.DurationMinutes=!0),(isNaN(+i.DurationHours)||+i.DurationHours<0)&&(h.DurationHours=!0),new Date(i.Date)<new Date("2024-01-01")&&(h.Date=!0),$.current=h,Object.keys(h).length===0},X=t.useCallback(async()=>{O(!0);try{const v=await(await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:De,type:"dropDailyRides"})})).json();if(v.success)d({open:!0,message:"✅ Live ride list updated!",severity:"success"}),Z(z().format("hh:mm A")),D(h=>h+1);else throw new Error(v.message)}catch(i){d({open:!0,message:`❌ ${i.message}`,severity:"error"})}finally{O(!1)}},[]),W=t.useCallback((i,v=p)=>{const{name:h,value:N}=i.target;let E=N;if(h==="TripID"){const f=N.replace(/[^a-zA-Z0-9]/g,"").toUpperCase();E=f.length>4?`${f.slice(0,4)}-${f.slice(4,6)}`:f}v(f=>({...f,[h]:E}))},[]),ye=t.useCallback(async()=>{if(j||!G(r)){d({open:!0,message:"❌ Fix form errors before submitting.",severity:"error"});return}s(!0);try{const i=me(r.DurationHours,r.DurationMinutes),v=z(r.Date).tz(ne).format("MM/DD/YYYY"),h=z(`2000-01-01T${r.PickupTime}`).tz(ne).format("h:mm A"),N={...r,Date:v,PickupTime:h,RideDuration:i,CreatedBy:w,LastModifiedBy:w},f=await(await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:De,type:"addRide",sheet:"RideQueue",data:N})})).json();if(f.success)d({open:!0,message:"✅ Ride added!",severity:"success"}),p(ie),C(!1);else throw new Error(f.message)}catch(i){d({open:!0,message:`❌ ${i.message}`,severity:"error"})}finally{s(!1)}},[r,j,w]),de=i=>W(i,p),K=i=>W(i,u),Ke=t.useCallback(()=>{if(!G(l)){d({open:!0,message:"❌ CSV builder incomplete or invalid",severity:"error"});return}const i=[l.TripID,z(l.Date).format("YYYY-MM-DD"),l.PickupTime,l.DurationHours,l.DurationMinutes,l.RideType,l.Vehicle,l.RideNotes||""].join(", ");J(v=>v?v+`
`+i:i),u(ie)},[l]),es=t.useCallback(async()=>{if(!Y.trim()){d({open:!0,message:"❌ No rides to submit",severity:"error"});return}s(!0);try{const i=Y.trim().split(`
`);await Promise.all(i.map(v=>{const[h,N,E,f,ue,ss,ts,is]=v.split(",").map(as=>as.trim()),ns=me(f,ue),rs={TripID:h,Date:z(N).format("MM/DD/YYYY"),PickupTime:z(`2000-01-01T${E}`).tz(ne).format("h:mm A"),RideDuration:ns,RideType:ss,Vehicle:ts,RideNotes:is,CreatedBy:w,LastModifiedBy:w};return fetch(fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:De,type:"addRide",sheet:"RideQueue",data:rs})})})),d({open:!0,message:"✅ Rides added!",severity:"success"}),J("")}catch(i){d({open:!0,message:`❌ ${i.message}`,severity:"error"})}finally{s(!1)}},[Y,w]);return e.jsxs(M,{sx:{maxWidth:1e3,mx:"auto",p:2},children:[e.jsxs(Be,{sx:{p:3,mb:4},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"🚌 Ride Entry"}),e.jsxs(Ne,{value:S,onChange:(i,v)=>o(v),sx:{mb:2},children:[e.jsx(ee,{label:"SINGLE RIDE"}),e.jsx(ee,{label:"MULTI RIDE UPLOAD"})]}),S===0&&e.jsxs(M,{sx:{px:n?1:3,py:2},children:[e.jsx(b,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"📝 Single Ride Details"}),e.jsxs(k,{container:!0,rowSpacing:.75,columnSpacing:1,children:[Te.map(({name:i,label:v,type:h="text",sm:N,shrink:E})=>e.jsx(k,{item:!0,xs:12,sm:N,children:e.jsxs(V,{name:i,label:v,type:h,select:h==="select",value:r[i],onChange:de,fullWidth:!0,margin:"dense",size:"small",error:!!$.current[i],helperText:$.current[i]&&"Required or Invalid",InputLabelProps:E?{shrink:!0}:void 0,sx:{"& .MuiInputBase-root":{py:.5},"& .MuiInputLabel-root":{top:-5}},children:[i==="RideType"&&Ye.map(f=>e.jsx(H,{value:f,children:f},f)),i==="Vehicle"&&ze.map(f=>e.jsx(H,{value:f,children:f},f))]})},i)),e.jsx(k,{item:!0,xs:12,children:e.jsx(V,{name:"RideNotes",label:"Ride Notes",value:r.RideNotes,onChange:de,fullWidth:!0,multiline:!0,rows:2,margin:"dense",size:"small",sx:{"& .MuiInputBase-root":{py:.5},"& .MuiInputLabel-root":{top:-5}}})}),e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(T,{fullWidth:!0,variant:"contained",color:"success",size:"medium",sx:{py:1.1,fontWeight:600},onClick:()=>{G(r)?C(!0):d({open:!0,message:"❌ Fix form before submit",severity:"error"})},children:"✅ Review & Confirm"})}),e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(T,{fullWidth:!0,variant:"outlined",color:"warning",size:"medium",sx:{py:1.1,fontWeight:600},onClick:()=>{p(ie),$.current={},d({open:!0,message:"♻️ Form reset.",severity:"info"})},children:"Reset"})})]})]}),S===1&&e.jsx(M,{sx:{px:n?1:3,py:2},children:e.jsxs(k,{container:!0,spacing:1,children:[e.jsx(k,{item:!0,xs:12,children:e.jsx(V,{label:"Paste CSV Rides",fullWidth:!0,multiline:!0,rows:6,value:Y,onChange:i=>J(i.target.value),margin:"dense"})}),e.jsx(k,{item:!0,xs:12,children:e.jsx(b,{variant:"subtitle2",fontWeight:"bold",sx:{mt:2},children:"Or Use Ride Builder"})}),Te.map(({name:i,label:v,type:h="text",sm:N,shrink:E})=>e.jsx(k,{item:!0,xs:12,sm:N,children:e.jsxs(V,{name:i,label:v,type:h,select:h==="select",value:l[i],onChange:K,fullWidth:!0,margin:"dense",size:"small",InputLabelProps:E?{shrink:!0}:void 0,sx:{"& .MuiInputBase-root":{py:.5},"& .MuiInputLabel-root":{top:-5}},children:[i==="RideType"&&Ye.map(f=>e.jsx(H,{value:f,children:f},f)),i==="Vehicle"&&ze.map(f=>e.jsx(H,{value:f,children:f},f))]})},i)),e.jsx(k,{item:!0,xs:12,children:e.jsx(V,{name:"RideNotes",label:"Ride Notes",value:l.RideNotes,onChange:K,fullWidth:!0,multiline:!0,rows:2,margin:"dense",size:"small",sx:{"& .MuiInputBase-root":{py:.5},"& .MuiInputLabel-root":{top:-5}}})}),e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(T,{variant:"outlined",fullWidth:!0,size:"medium",onClick:Ke,sx:{py:1.1,fontWeight:600},children:"➕ Add to List"})}),e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(T,{variant:"contained",color:"success",fullWidth:!0,size:"medium",onClick:es,disabled:j,sx:{py:1.1,fontWeight:600},children:j?e.jsx(pe,{size:20,color:"inherit"}):"🚀 Submit All Rides"})})]})})]}),e.jsx(Be,{sx:{p:2,mb:3},children:e.jsxs(M,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(b,{variant:"caption",color:"text.secondary",children:[e.jsx(We,{fontSize:"small",sx:{mr:1}}),"Synced: ",A]}),e.jsx(T,{onClick:X,variant:"outlined",color:"secondary",startIcon:e.jsx(We,{sx:{animation:I?"spin 1s linear infinite":"none"}}),children:"🔁 Refresh"})]})}),e.jsxs(Ne,{value:B,onChange:(i,v)=>ce(v),centered:!0,sx:{mb:2},children:[e.jsx(ee,{label:e.jsxs(M,{display:"flex",alignItems:"center",justifyContent:"center",gap:.5,children:[e.jsx(b,{fontWeight:600,color:B===0?"success.main":"inherit",children:"LIVE"}),e.jsx(Ce,{badgeContent:a,color:"success",sx:{"& .MuiBadge-badge":{transform:"scale(0.8) translate(100%, -20%)",transformOrigin:"top right"}}})]})}),e.jsx(ee,{label:e.jsxs(M,{display:"flex",alignItems:"center",justifyContent:"center",gap:.5,children:[e.jsx(b,{fontWeight:600,color:B===1?"success.main":"inherit",children:"QUEUE"}),e.jsx(Ce,{badgeContent:P,color:"primary",sx:{"& .MuiBadge-badge":{transform:"scale(0.8) translate(100%, -20%)",transformOrigin:"top right"}}})]})}),e.jsx(ee,{label:e.jsxs(M,{display:"flex",alignItems:"center",justifyContent:"center",gap:.5,children:[e.jsx(b,{fontWeight:600,color:B===2?"success.main":"inherit",children:"CLAIMED"}),e.jsx(Ce,{badgeContent:c,color:"secondary",sx:{"& .MuiBadge-badge":{transform:"scale(0.8) translate(100%, -20%)",transformOrigin:"top right"}}})]})})]}),e.jsxs(M,{sx:{width:"100%",overflowX:"hidden"},children:[B===0&&e.jsx(Es,{refreshTrigger:L}),B===1&&e.jsx(Ws,{refreshTrigger:L}),B===2&&e.jsx(Ys,{refreshTrigger:L})]}),e.jsxs(_,{open:x,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{children:"Confirm Ride"}),e.jsx(F,{dividers:!0,children:Vs.map(i=>e.jsxs(b,{children:[e.jsxs("strong",{children:[i.replace(/([A-Z])/g," $1"),":"]})," ",(R==null?void 0:R[i])||"—"]},i))}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(T,{onClick:ye,variant:"contained",color:"success",children:"Submit"})]})]}),e.jsx(le,{open:m.open,autoHideDuration:4e3,onClose:()=>d({...m,open:!1}),children:e.jsx(oe,{severity:m.severity,variant:"filled",children:m.message})})]})}export{$s as default};
