import{e as F,r as s,q as c,G,j as e,B as f,P as C,H as J,J as _,T as i,K as V,L as q,N as S,O as K,Q as H,R as E,h as v,U as Q,k as X,l as Z,V as ee,W as te}from"./main-Cw184DFO.js";const re=({driver:l,setIsTracking:N})=>{const R=F().palette.mode==="dark",[g,T]=s.useState(""),[o,D]=s.useState(null),[x,Y]=s.useState(null),[r,w]=s.useState(!1),[d,p]=s.useState(!1),[u,j]=s.useState(!1),[B,A]=s.useState(0),[L,U]=s.useState([]),[m,M]=s.useState({open:!1,message:"",severity:"success"}),[b,k]=s.useState(!1),y=(t,a="success")=>M({open:!0,message:t,severity:a});s.useEffect(()=>{const t=JSON.parse(localStorage.getItem("lrp_timeTrack")||"{}");t.driver===l&&t.startTime&&(T(t.rideId||""),D(c(t.startTime)),w(!0),p(t.isNA||!1),j(t.isMulti||!1))},[l]),s.useEffect(()=>{N(r)},[r,N]),s.useEffect(()=>{let t;return r&&o&&(t=setInterval(()=>{A(c().diff(o,"second"))},1e3)),()=>clearInterval(t)},[r,o]);const I=s.useCallback(()=>{G(l).then(U)},[l]);s.useEffect(()=>{I()},[I]);const P=()=>{if(!l||!g&&!d&&!u)return y("Please enter a Ride ID or check N/A / Multiple","error");const t=c(),a=d?"N/A":u?"MULTI":g;D(t),Y(null),w(!0),k(!0),localStorage.setItem("lrp_timeTrack",JSON.stringify({driver:l,rideId:a,isNA:d,isMulti:u,startTime:t.toISOString()})),setTimeout(()=>k(!1),1e3)},O=()=>{const t=c();Y(t),w(!1),k(!0);const a=t.diff(o,"minute"),n={driver:l,rideId:d?"N/A":u?"MULTI":g,startTime:o.format("MM/DD/YYYY HH:mm"),endTime:t.format("MM/DD/YYYY HH:mm"),duration:a,loggedAt:c().format("MM/DD/YYYY HH:mm")};ee(n).then(h=>{h.success?(y("✅ Time successfully logged!"),localStorage.removeItem("lrp_timeTrack"),T(""),p(!1),j(!1),A(0),I()):y(`❌ Failed to log time: ${h.message}`,"error")}).catch(h=>y("❌ Network error: "+h.message,"error")).finally(()=>k(!1))},z=t=>{const a=Math.floor(t/60),n=t%60;return`${a}m ${n<10?"0":""}${n}s`},W=[{field:"rideId",headerName:"Ride ID",flex:1,renderCell:({row:t})=>{let a="default";return t.rideIdRaw==="N/A"?a="warning":t.rideIdRaw==="MULTI"?a="info":a="success",e.jsx(S,{title:t.rideIdRaw==="N/A"?"Non-Ride Task":t.rideIdRaw==="MULTI"?"Multiple Back-to-Back Rides":`Ride ID: ${t.rideId}`,children:e.jsx(te,{label:t.rideId,color:a,size:"small"})})}},{field:"start",headerName:"Start Time",flex:1.5},{field:"end",headerName:"End Time",flex:1.5},{field:"duration",headerName:"Duration (hrs)",flex:1,type:"number"}],$=L.map((t,a)=>{const n=t.rideId||"N/A";return{id:a,rideIdRaw:n,rideId:n==="N/A"?"N/A":n==="MULTI"?"Multiple":n,start:c(t.start).format("MM/DD/YYYY HH:mm"),end:c(t.end).format("MM/DD/YYYY HH:mm"),duration:(parseInt(t.duration)/60).toFixed(t.duration<60?1:0)}});return e.jsxs(f,{maxWidth:600,mx:"auto",children:[e.jsx("style",{children:`
        @keyframes pulse {
          0% { transform: scale(1); opacity: 0.75; }
          50% { transform: scale(1.25); opacity: 1; }
          100% { transform: scale(1); opacity: 0.75; }
        }
      `}),e.jsxs(C,{sx:{p:3,borderLeft:"5px solid #4cbb17"},children:[e.jsxs(J,{sx:{mb:2},children:[e.jsx(_,{expandIcon:e.jsx(V,{}),children:e.jsx(i,{variant:"subtitle1",children:"📖 How to Use The Time Tracker & Moovs"})}),e.jsxs(q,{children:[e.jsxs(i,{variant:"body2",gutterBottom:!0,children:["⏱️ Use the ",e.jsx("strong",{children:" 🚀 Start"})," button when you begin working. If it's not for a ride, check ",e.jsx("strong",{children:"N/A – Non-Ride Task"}),"."]}),e.jsx(i,{variant:"body2",gutterBottom:!0,children:"✨ Start the trip in Moovs when you are actually on the way to get the customer, instead of when you are starting the get-ready and washing the vehicle."}),e.jsxs(i,{variant:"body2",gutterBottom:!0,children:["🛑 Press ",e.jsx("strong",{children:"End"})," when finished to log your time."]}),e.jsxs(i,{variant:"body2",gutterBottom:!0,children:["📝 You can enter a ",e.jsx("strong",{children:"Ride ID"})," for ride-related work, or check ",e.jsx("strong",{children:"N/A"})," for meetings, cleaning, prep, etc."]}),e.jsxs(i,{variant:"body2",gutterBottom:!0,children:["📋 View previous sessions below. Use ",e.jsx("strong",{children:"🔄 Refresh"})," if your recent entry isn't showing."]}),e.jsx(i,{variant:"body2",gutterBottom:!0,children:"💡 Don’t close the tab while tracking — or it might pause your timer."}),e.jsxs(i,{variant:"body2",gutterBottom:!0,children:["🦒 If you're doing back-to-back rides with no meaningful break in between, you can now use the new ",e.jsx("strong",{children:"Multiple Back-to-Back Rides"})," option to track them all together."]})]})]}),e.jsx(i,{variant:"h6",mb:2,children:"⏱️ Time Clock"}),e.jsx(S,{title:"Enter the Ride ID if this session relates to a specific trip.",children:e.jsx("span",{children:e.jsx(K,{label:"Ride ID",value:g,onChange:t=>T(t.target.value.trimStart()),fullWidth:!0,margin:"normal",disabled:r||d||u})})}),e.jsx(S,{title:"Use this for prep work, meetings, or anything not tied to a ride.",children:e.jsx("span",{children:e.jsx(H,{control:e.jsx(E,{checked:d,onChange:t=>{p(t.target.checked),t.target.checked&&j(!1)},disabled:r}),label:"N/A – Non-Ride Task"})})}),e.jsx(S,{title:"Use this when doing multiple rides back-to-back without breaks.",children:e.jsx("span",{children:e.jsx(H,{control:e.jsx(E,{checked:u,onChange:t=>{j(t.target.checked),t.target.checked&&p(!1)},disabled:r}),label:"Multiple Back-to-Back Rides"})})}),e.jsxs(f,{mt:2,display:"flex",gap:2,children:[e.jsx(v,{fullWidth:!0,disabled:r||b,onClick:P,variant:"contained",sx:{bgcolor:"#4cbb17"},children:b&&!r?"⏳ Starting...":"🚀 Start"}),e.jsx(v,{fullWidth:!0,disabled:!r||b,onClick:O,color:"error",variant:"contained",children:b&&r?"⏳ Logging...":"🛑 End"})]}),e.jsxs(f,{mt:2,children:[r&&e.jsxs(i,{color:"success.main",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{style:{animation:"pulse 1.5s infinite",fontSize:"1.2rem"},children:"🟢"}),"Started at ",o==null?void 0:o.format("HH:mm")," — Elapsed: ",z(B)]}),!r&&x&&e.jsxs(i,{color:"primary.main",children:["Ended at ",x==null?void 0:x.format("HH:mm")]})]})]}),e.jsxs(f,{mt:4,children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsx(i,{variant:"subtitle1",children:"📋 Previous Sessions"}),e.jsx(v,{variant:"outlined",size:"small",onClick:I,children:"🔄 Refresh"})]}),e.jsx(C,{elevation:2,sx:{p:1,backgroundColor:R?"#1e1e1e":"#fff"},children:e.jsx(Q,{rows:$,columns:W,autoHeight:!0,pageSize:5,rowsPerPageOptions:[5,10,25],disableRowSelectionOnClick:!0,disableColumnMenu:!0,density:"compact",sx:{backgroundColor:R?"#2a2a2a":"#fafafa",fontSize:"0.9rem","& .MuiDataGrid-overlay":{textAlign:"center",pt:4}}})})]}),e.jsx(X,{open:m.open,autoHideDuration:4e3,onClose:()=>M({...m,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Z,{onClose:()=>M({...m,open:!1}),severity:m.severity,variant:"filled",children:m.message})})]})};export{re as default};
