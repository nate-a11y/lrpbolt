rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    function isAuthed() { return request.auth != null; }
    function isAdmin() { return isAuthed() && (request.auth.token.admin == true || request.auth.token.role == "admin"); }

    // Ticket attachments live under tickets/{ticketId}/{filename}
    match /tickets/{ticketId}/{fileName} {
      allow read, write, delete: if isAuthed();
    }

    // New Issue Tracker attachments
    match /issueTickets/{ticketId}/{fileName} {
      allow read, write, delete: if isAuthed();
    }

    // Important Info images - all authenticated users have full access
    match /importantInfo/{itemId}/{fileName} {
      allow read, write, delete: if isAuthed();
    }
  }
}
